<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>EXPRESSAIR</title>
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	 <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
	  <script src="js/bootstrap.bundle.min.js"></script>
	  <script src="js/jquery.min.js"></script>
	  <link rel="stylesheet" type="text/css" href="css/set1.css" />
 
<!--  list -->
<link rel="stylesheet" href="css/jquery-ui.min.css">
  <script src="js/jquery-ui.min.js"></script>
 <!--  /list -->
 <!--  datapicker -->
  <script src="js/jquery.datepicker.extension.range.min.js"></script>
 <!--  /datapicker -->
<link rel="stylesheet" href="css/main.css">  

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark fixed-top  ">
	
  <div class="container-fluid container">
    <a class="navbar-brand logo" href="#">EXPRESSAIR</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 justify-content-around flex-wrap">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Главная</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Услуги</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">О нас</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Партнёры</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Контакты</a>
        </li>
      </ul>
      <div class="d-flex flex-wrap justify-content-center">
       <button class="btn btn-reg" data-bs-toggle="modal" data-bs-target="#modal-reg">Заявка на регистрацию</button>
       <button class="btn btn-login" >Личный Кабинет</button>
      </div>
    </div>
  </div>

</nav>
<div class="section-header">
	<div class="container">
	
	<div class="section-header_left">
		<div class="_left-text">УЖЕ 10 ЛЕТ</div>
		<div class="_left-caption">Оптимизируем затраты ваших деловых поездок</div>
		<div class="_left-content">предоставляем комплексное корпоративное туристическое обслуживание </div>
	</div>


	<div class="wrapper">
		<div class="header-form-edit">
				<div class="header-form-edit-caption">ALA - NQZ</div>
				<div class="header-form-edit-text">04.02.21 - 24.03.21</div>
		</div>
		<ul class="header-form">
			<div class="form_li1-outer">
					<li class="header-form_li box1 box-first">
						<div class="form_li-caption"></div>
						<input  id="place-1" placeholder="Откуда" class="header-form_airport form_li-input">
						<div id="airport-1" class="form_li-airport airport1"></div>
					</li>
				
				<div class="header_btn-revers"><img src="img/revers.svg" alt=""></div>

			</div>

			<li class="header-form_li box1">
				<div class="form_li-caption "></div>
				<input  id="place-2" placeholder="Куда" class="header-form_airport form_li-input input2">
				<div id="airport-2" class="form_li-airport"></div>
			</li>

			<div id="date_range" class="header-date_range1">
				<div class="form-datapicker_btn">Обратный билет не нужен</div>
			</div>


			<li class="header-form_li box2">
				<div class="form_li-caption ">Когда</div>
				<input type="text" readonly placeholder="Сегодня" name="startDate" class=" form_li-input" name="start" />
			</li>

			<li class="header-form_li box2">
				<div class="form_li-caption ">Обратно</div>
				<input type="text" readonly name="endDate" class=" form_li-input" name="end" />
			</li>
	     
	    <li class="header-form_li box1 box1-last sitter">
				<div class="form_li-caption sitter_class">Эконом</div>
				<input type="text" value="1 пассажир" id="passenger_num" readonly  class="form_li-input passenger_num" >
				</li><div class="list-sitter_outer">
				<div class="list-sitter">
		<div class="list-sitter_li">
			<div class="list-sitter_li-left">
				<div class="list-sitter_li-left__caption">Взрослые</div>
				<div class="list-sitter_li-left__text">Старшее 12 лет</div>
			</div>
			<div class="list-sitter_li-right">
				<button class="btn btn-minus btn-minus_active">–</button>
				<span class="counter" id="counter1">1</span>
				<button class="btn btn-plus">+</button>
			</div>
		</div>

		<div class="list-sitter_li">
			<div class="list-sitter_li-left">
				<div class="list-sitter_li-left__caption">Дети</div>
				<div class="list-sitter_li-left__text">от 2 до 12 лет</div>
			</div>
			<div class="list-sitter_li-right">
				<button class="btn btn-minus">–</button>
				<span class="counter" id="counter2">0</span>
				<button class="btn btn-plus">+</button>
			</div>
		</div>
		<div class="list-sitter_li">
			<div class="list-sitter_li-left">
				<div class="list-sitter_li-left__caption">Младенцы</div>
				<div class="list-sitter_li-left__text">до 2 лет, без места</div>
			</div>
			<div class="list-sitter_li-right">
				<button class="btn btn-minus">–</button>
				<span class="counter">0</span>
				<button class="btn btn-plus">+</button>
			</div>
		</div>
		<hr>
		<!-- ================= -->
		<label class="list-sitter_label">
	      <input type="radio" class="list-sitter__checkbox" name="sitter" value="Эконом" checked=""><span class="fake"></span>
	      <p>Эконом</p>
	   </label>
	   <label class="list-sitter_label">
	      <input type="radio" class="list-sitter__checkbox" name="sitter" value="Комфорт"><span class="fake"></span>
	      <p>Комфорт</p>
	   </label>
	   <label class="list-sitter_label">
	      <input type="radio" class="list-sitter__checkbox" name="sitter" value="Бизнес"><span class="fake"></span>
	      <p>Бизнес</p>
	   </label>
	   <label class="list-sitter_label">
	      <input type="radio" class="list-sitter__checkbox" name="sitter" value="Первый класс"><span class="fake"></span>
	      <p>Первый класс</p>
	   </label>
		<!-- ================= -->
		</div>
		</div>
				<button class="btn btn-header_sub">Смотреть расписание</button>
			</ul>
	</div>


	</div>
</div>

<section class="section-ticket">
	<div class="container section-ticket_container">
		<!-- <div class="progress"><div class="progress-bar" role="progressbar" aria-valuemin="1" aria-valuemax="10"></div></div> -->
		<div class="filter-icon">Фильтр<img src="img/filter.svg" class="filter-icon_img" alt=""></div>
		<div class="section-ticket_left">
			<div class="ticket-spoiler-mobile_header">
				<div class="ticket-spoiler-mobile_clear"></div>
				<div class="ticket-spoiler-mobile_text">Фильтр</div>
				<img class="btn ticket-spoiler-mobile_exit" src="img/exit.png" alt="">
			</div>
			<div class="ticket-spoiler">
				<div class="ticket-filter">
					<div class="ticket-filter_title">Сортировка</div>
					<select class="ticket-filter_input" id="filter">
						<option disabled selected>Выберите фильтр</option>
						<option value="1">Сначала дешёвые</option>
			      <option value="-1">Сначала дорогие</option>
			    </select>
				</div>
				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Пересадки
					</div>
					<div class="ticket-spoiler_content">
					<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="ticket-spoiler" value="1"><span class="ticket-spoiler_fake"></span>
	      			<p>Все</p></div>
	      			<div class="ticket-check_sum">32 062  ₸</div>
	   			</label>
	   			<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" class="ticket-spoiler__checkbox" name="ticket-spoiler" value="2"><span class="ticket-spoiler_fake"></span>
	      			<p>1 пересадка</p></div>
	      			<div class="ticket-check_sum">32 062  ₸</div>
	   			</label>
	   			
					</div>
				</div>
				<!-- <div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Пересадки с визой
					</div>
					<div class="ticket-spoiler_content">
					<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="ticket-spoiler1" ><span class="ticket-spoiler_fake"></span>
	      			<p>Все</p></div>
	      			<div class="ticket-check_sum">32 062  ₸</div>
	   			</label>
	   			<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" class="ticket-spoiler__checkbox" name="ticket-spoiler1" ><span class="ticket-spoiler_fake"></span>
	      			<p>в Шымкент</p></div>
	      			<div class="ticket-check_sum">32 062  ₸</div>
	   			</label>
	   			</div>
				</div> -->
				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Длительность пересадки
					</div>
					<div class="ticket-spoiler_content">
						<div class="ticket-slider_content">
							  <input type="text" class="slider_input" id="slider_input1" readonly>
							  <input type="text" class="slider_input" id="slider_input2" readonly>
					</div>
 					<div class="slider-range" id="slider-range1"></div>
					</div>
				</div>
				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Время в пути
					</div>
					<div class="ticket-spoiler_content">
						<div class="ticket-slider_title">Алматы – Нур-Султан</div>
						<div class="ticket-slider_content">
							  <input type="text" class="slider_input" id="slider_input3" readonly>
							  <input type="text" class="slider_input" id="slider_input4" readonly>
					</div>
 					<div class="slider-range" id="slider-range2"></div>
 					<div class="ticket-slider_title">Нур-Султан - Алматы </div>
						<div class="ticket-slider_content">
							  <input type="text" class="slider_input" id="slider_input5" readonly>
							  <input type="text" class="slider_input" id="slider_input6" readonly>
					</div>
 					<div class="slider-range" id="slider-range3"></div>
					</div>
				</div>

				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Авиакомпании
					</div>
					<div class="ticket-spoiler_content">
					<div class="spoiler-content_AirlineName">
					<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="AirlineName" value="1"><span class="ticket-spoiler_fake"></span>
	      			<p>Все</p></div>
	      			<div class="ticket-check_sum"></div>
	   			</label>
	   			</div>	   			
					</div>
				</div>

				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Аэропорты
					</div>
					<div class="ticket-spoiler_content">

					<div class="ticket-slider_title">Вылет</div>
					<div class="spoiler-content_DepartureAirport">
					<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="2" value="1"><span class="ticket-spoiler_fake"></span>
	      			<p>Все</p></div>
	      			<div class="ticket-check_sum"></div>
	   			</label>
					</div>
	   			<div class="ticket-slider_title">Прибытия</div>
	   			<div class="spoiler-content_ArrivalAirport">
	   			<label class="ticket-spoiler_label">
						<div class="ticket-check_left">
	      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="3" value="1"><span class="ticket-spoiler_fake"></span>
	      			<p>Все</p></div>
	      			<div class="ticket-check_sum"></div>
	   			</label>
	   			</div>
					</div>
				</div>

				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Аэропорты пересадки
					</div>
					<div class="ticket-spoiler_content">
						<div class="ticket-slider_title">Алматы – Нур-Султан</div>
						<div class="spoiler-content_StopAirport1">
						<label class="ticket-spoiler_label">
							<div class="ticket-check_left">
		      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="StopAirport1" value="1"><span class="ticket-spoiler_fake"></span>
		      			<p>Все</p></div>
		      			<div class="ticket-check_sum">32 062  ₸</div>
		   			</label>
		   			</div>
		   			<div class="ticket-slider_title">Нур-Султан – Алматы </div>
		   			<div class="spoiler-content_StopAirport2">
						<label class="ticket-spoiler_label">
							<div class="ticket-check_left">
		      			<input type="radio" checked="" class="ticket-spoiler__checkbox" name="StopAirport2" value="1"><span class="ticket-spoiler_fake"></span>
		      			<p>Все</p></div>
		      			<div class="ticket-check_sum">32 062  ₸</div>
		   			</label>
		   			</div>
						</div>
				</div>

				<div class="ticket-spoiler_item">
					<div class="ticket-spoiler_title">
						Цена билета
					</div>
					<div class="ticket-spoiler_content">
						<div class="ticket-slider_content">
							  <input type="text" class="slider_input" id="slider_input7" readonly>
							  <input type="text" class="slider_input" id="slider_input8" readonly>
					</div>
 					<div class="slider-range" id="slider-range4"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="section-ticket_right">
		</div>
		<div class="section-ticket_right__mobile">
		</div>
		<div class="clear"></div>
	</div>
</section>

	<!-- Modal-reserve -->
	<div class="modal fade" id="modal-reserve" tabindex="-1" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Заявка на бронь билетов</h5>
	        <button type="button" class="btn-close modal-ticket_btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <ul class="modal-inner_ul">
	      	<li class="modal-inner_li">Алматы – Москва <span>11.07.2021</span></li>
	      	<li class="modal-inner_li">Алматы – Москва <span>11.07.2021</span></li>
	      	<li class="modal-inner_li">Взрослых: <span>1</span></li>
	      	<li class="modal-inner_li">Взрослых: <span>1</span></li>
	      </ul>
	      <div class="modal-body">

	      	<div class="modal-body_li modal-body_li-2 input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="name-1" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Как вас зовут?</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li-2 input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="surname-1" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Фамилия</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="company-1" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Название компании</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="phone" />
						<label class="input__label input__label--haruki">
							<span class="input__label-content input__label-content--haruki">Контактный телефон</span>
						</label>
					</div>

	      </div>

	        <button type="button" class="btn btn-modal">Отправить заявку</button>
	      
	    </div>
	  </div>
	</div>

	<!-- Modal-reg -->
	<div class="modal fade" id="modal-reg" tabindex="-1" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Заявка на регистрацию</h5>
	        <button type="button" class="btn-close modal-ticket_btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">

	      	<div class="modal-body_li modal-body_li-2 input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="name-2" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Как вас зовут?</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li-2 input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="surname-2" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Фамилия</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="company-2" />
						<label class="input__label input__label--haruki" for="input-1">
							<span class="input__label-content input__label-content--haruki">Название компании</span>
						</label>
					</div>
					<div class="modal-body_li modal-body_li input input--haruki">
						<input class="input__field input__field--haruki" type="text" id="phone-1"  />
						<label class="input__label input__label--haruki">
							<span class="input__label-content input__label-content--haruki">Контактный телефон</span>
						</label>
					</div>

	      </div>

	        <button type="button" class="btn btn-modal">Отправить заявку</button>
	      
	    </div>
	  </div>
	</div>

	<!-- Modal-ticket -->
	<div class="modal fade" id="modal-ticket" tabindex="-1" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered modal-ticket_dialog">
	    <div class="modal-content modal-ticket_content">
	        <button type="button" class="btn-close modal-ticket_btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      <div class="modal-body modal-ticket-body">
	      	<div class="modal-ticket_left">
	      	<div class="modal-ticket_left-wrap">
	      		<div class="modal-ticket_price">243 021 ₸</div>
	      		<label class="modal-ticket_check-block">
						  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
						  <div class="modal-ticket_check-text">Classic</div>
						  <div class="modal-ticket_check-price">+ 0 ₸</div> 
						</label>
						<label class="modal-ticket_check-block">
						  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
						  <div class="modal-ticket_check-text">Plus</div>
						  <div class="modal-ticket_check-price">+ 16 000 ₸</div> 
						</label>
	      		<div class="modal-ticket_option include">Бонусные мили</div>
	      		<div class="modal-ticket_option include">Выбор места на борту</div>
	      		<div class="modal-ticket_option include">Ручная кладь до 8 кг.</div>
	      	</div>
	      		<button type="button" class="btn section-ticket_btn modal-ticket_btn" data-bs-toggle="modal" data-bs-target="#modal-reserve"><div class="section-ticket_btn-sum modal-btn">243 021 ₸</div>
						<div class="section-ticket_btn-text ">Оставить заявку на бронь</div></button>
	      	</div>
	      	<div class="modal-ticket_right">
	      	</div>
	      </div>	      
	    </div>
	  </div>
	</div>


<script src="js/classie.js"></script>
<script src="js/jquery.maskedinput.min.js"></script>
<script src="js/date.js"></script>

<script>
	$(document).ready(function(){
 $(window).on("scroll",function(){
   var wn = $(window).scrollTop();
    if(wn > 30){
     $(".navbar").css("background","#1F78FE");
    }
    else{
     $(".navbar").css("background","none");
    }
  });

 $("#phone").mask("+7 (999) 99-99-999");
 $("#phone-1").mask("+7 (999) 99-99-999");


$("#place-1").click(function(e){
	$(this).prev().text("Откуда");
	$(this).attr("placeholder","");
});
$("#place-2").click(function(e){
	$(this).prev().text("Куда");
	$(this).attr("placeholder","");
});


$(".header_btn-revers").click( function(e){
     var place1 = $('#place-1').val();
     var place2 = $('#place-2').val();
     var airport1 = $('#airport-1').text();
     var airport2 = $('#airport-2').text();
     $('#place-1').val(place2);
     $('#place-2').val(place1);
     $('#airport-1').text(airport2);
     $('#airport-2').text(airport1);

});

$(".sitter").click( function(e){
    $(".list-sitter").toggleClass('active');
    $(".sitter").toggleClass('active');
});

function count_pas() {
	var num = parseInt($("#counter1").text()) + parseInt($("#counter2").text());
	var text;
	if (num == 1) {
		text = num + " пассажир";
	}else if(num > 1 & num<5){
		text = num + " пассажира";
	}else{
		text = num + " пассажиров";
	};
  $('#passenger_num').val(text);
	};

$(".btn-plus").click( function(e){
     var counter =parseInt($(this).prev().text()) + 1;
     $(this).prev().text(counter);
     if(counter > 0){
     	$(this).siblings().filter('.btn-minus').addClass("btn-minus_active")
      }
      count_pas();
});
$(".btn-minus").click( function(e){
     var counter =parseInt($(this).next().text()) - 1;
     if ( counter == 0 ){
     	$(this).removeClass("btn-minus_active")
     };
     if ( counter < 0 )return;

     $(this).next().text(counter);
     var num = parseInt($("#counter1").text()) + parseInt($("#counter2").text());
	var text;
	if (num == 1) {
		text = num + " пассажир";
	}else if(num > 1 & num<5){
		text = num + " пассажира";
	}else{
		text = num + " пассажиров";
	};
  $('#passenger_num').val(text);
});

 $('.list-sitter__checkbox').change(function() {
    $('.sitter_class').text($(this).val());
  });

// =========== btn_sub click ==============
$(".btn-header_sub").click( function(e){

     $(".section-header_left").addClass("search");
     $(".section-header").addClass("search");
     $(".section-ticket").addClass("search");
     $(".section-ticket_left").addClass("search");
      if ($(window).width() <= '1200'){
     $(".filter-icon").addClass("search");
     
     };
     if ($(window).width() <= '990'){
			$(".header-form-edit").addClass("search");
     $(".header-form").addClass("search");
     }
   //   	$(".progress-bar").animate({width : 100+"%" }, 1000);
   //   	setTimeout(function(){
   //   	  	$(".progress").css("display", "none" );
			// }, 1500);     
			$.getJSON('mydata.json', function(data) {
	Date.prototype.format = function (mask, utc) {
    return dateFormat(this, mask, utc);
};
function CountMinutes( i, f, n ){
return new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[f].FlightDuration)).getMinutes() + new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[f].FlightDuration)).getHours() * 60;
}
function CountMinutesStop( num, f ,n ){

return Math.trunc((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[f+1].DepartureDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[f].ArrivalDateTime)))/ 60000 )
}

function StopDuration(i , f, n){
	var min = CountMinutesStop(i, f, n) % 60;
	if (min == 0) {
		min = min + "0";
	}
	return Math.trunc(CountMinutesStop(i, f, n) / 60) + " ч "+ min + " мин";
}

function FlightDuration(n, num){
 // var day = new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)).format("d") - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)).format("d");
 var day = 0;
 if(day == 0){
 	day = "";
 }else{
 	day = day + " д ";
 }
var hour = Math.trunc((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)))/3600000);
var min = ((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)))%3600000)/60000;
 return day+hour+" ч "+min+" мин";
}

function SegmentDuration(i , n){
	var segment = data.ParsedData.PricedItineraries[i].Directions[n].Segments.length;
	if (segment == 1) {
	var write = "<div class='trip-segment_connector' style='flex-grow: 1;' data-toggle='tooltip' title='в пути "+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].FlightDuration)).format("HH:MM")+"'></div>";
 }else{
 	var write = "<div class='trip-segment_connector' style='flex-grow: "+ CountMinutes(i, 0, n)+";' data-toggle='tooltip' title='в пути "+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].FlightDuration)).format("HH:MM")+"'></div><div data-iatas='"+ data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].ArrivalAirport+"' class='trip-segment_stop'style='flex-grow: "+ CountMinutesStop(i,0,n)+";' data-toggle='tooltip' title='Пересадка: "+  StopDuration(i,0, n) +"'></div><div class='trip-segment_connector'style='flex-grow:"+ CountMinutes(i, 1, n)+";' data-toggle='tooltip' title='в пути "+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[1].FlightDuration)).format("HH:MM")+"'></div>"
 }
	return write;
}
function Baggages(i,n){
	var weight = data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].Baggages[0].Quantity;
	if (weight == 0) {
		var write = "<div class='section-ticket_weight-num none'>&#215</div><div class='section-ticket_weight-text'>Нет багажа</div></div>";
	}else if (weight == 1) {
	 var write = "<div class='section-ticket_weight-num'>х 1</div><div class='section-ticket_weight-text'>Одно багажное место</div></div>";
	}else{
		var write = "<div class='section-ticket_weight-num'>10 кг</div><div class='section-ticket_weight-text'>Багаж до 10 кг</div></div>";
	}
	return write;
}

function stop_duration(i,n){
	if (data.ParsedData.PricedItineraries[i].Directions[n].Segments.length !== 1) {
		return CountMinutesStop(i,0,n)
	}else{
		return "0";
	}
}
function fly_duration1(i,n){
	if(data.ParsedData.PricedItineraries[i].Directions[0] != null){
	return ((new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[0].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[0].DepartureDateTime)))/60000)}else{
	return "0"	
	}
}
function fly_duration2(i,n){
	return ((new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].DepartureDateTime)))/60000);
}

let FlyDuration1Row = [];
var Duration1Max = 0;
var Duration1Min = 1000;
let FlyDuration2Row = [];
var Duration2Max = 0;
var Duration2Min = 1000;
let StopDurationRow = [];
var StopDurationMax = 0;
var StopDurationMin = 1000;

let DepartureAirport = [];
let ArrivalAirport = [];
let AirlineName = [];
let StopAirport1 = [];
let StopAirport2 = [];

let PriceRow = [];
var PriceMax = 0;
var PriceMin = 10000000;

for (var i = 0; i < data.ParsedData.PricedItineraries.length; ++i) {

if(data.ParsedData.PricedItineraries[i].Directions[0] == null){
	var n=1;
}else{
	var n=0;
}

$(".section-ticket_right").append("<div class='section-ticket_item ' item-number='"+i+"'  fly-duration1='"+ fly_duration1(i,n) +"' fly-duration2='"+ fly_duration2(i,1) +"' stop-duration='"+ stop_duration(i,n) +"' segment='"+ data.ParsedData.PricedItineraries[i].Directions[n].Segments.length+"'> <div class='section-ticket_item-left'> <div class='section-ticket_weight'>"+ Baggages(i ,n) +"<button type='button' class='btn section-ticket_btn' data-bs-toggle='modal' data-bs-target='#modal-reserve'><div class='section-ticket_btn-sum'>"+ data.ParsedData.PricedItineraries[i].PriceInformation.BaseFare +" ₸</div><div class='section-ticket_btn-text'>Оставить заявку на бронь</div></button> </div><div class='section-ticket_item-right'> <div class='section-ticket_item-trip'> <div class='item-trip_header'> <div class='item-trip_carriers'> <img class='trip-carriers_img' src='img/carrier1.jpg' alt=''> <img class='trip-carriers_img' src='img/carrier1.jpg' alt=''> </div><div class='item-trip-label_wrap'></div></div><div class='item-trip_outer'> <div class='item-trip_schedule'> <div class='item-trip_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].DepartureDateTime)).format("HH:MM") +"</div><div class='item-trip_city'>"+ data.ParsedData.PricedItineraries[i].Directions[n].DepartureAirportRu +"</div><div class='item-trip_date'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].DepartureDateTime)).format("d mmm yyyy, ddd") +"</div></div><div class='item-trip_segment-wrap'> <div class='trip-segment_duration'>"+ FlightDuration(n, i) +"</div><div class='trip-segment_path'> <div class='trip-segment_endpoint'> <img src='img/trip-plane.png' class='trip-segment_plane' alt=''> <div class='trip-segment_airport'>"+ data.ParsedData.PricedItineraries[i].Directions[n].DepartureAirport +"</div></div>"+ SegmentDuration(i, n)+"<div class='trip-segment_endpoint'> <img src='img/trip-plane.png' class='trip-segment_plane __arrival' alt=''> <div class='trip-segment_airport __arrival'>"+ data.ParsedData.PricedItineraries[i].Directions[n].ArrivalAirport +"</div></div></div></div><div class='item-trip_schedule'> <div class='item-trip_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].ArrivalDateTime)).format("HH:MM") +"</div><div class='item-trip_city'>"+ data.ParsedData.PricedItineraries[i].Directions[n].ArrivalAirportRu +"</div><div class='item-trip_date'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].ArrivalDateTime)).format("d mmm yyyy, ddd") +"</div></div></div>"+ DirectionsTicket(i, n) + "</div></div><div class='clear'></div></div>");

function DirectionsTicket(i,n){
	if (data.ParsedData.PricedItineraries[i].Directions.length == 1 || n == 1) {
		 return "";
	}else{
		return "<hr class='item-trip_hr'><div class='item-trip_outer'> <div class='item-trip_schedule'> <div class='item-trip_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].DepartureDateTime)).format("HH:MM") +"</div><div class='item-trip_city'>"+ data.ParsedData.PricedItineraries[i].Directions[1].DepartureAirportRu +"</div><div class='item-trip_date'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].DepartureDateTime)).format("d mmm yyyy, ddd") +"</div></div><div class='item-trip_segment-wrap'> <div class='trip-segment_duration'>"+ FlightDuration(1, i) +"</div><div class='trip-segment_path'> <div class='trip-segment_endpoint'> <img src='img/trip-plane.png' class='trip-segment_plane' alt=''> <div class='trip-segment_airport'>"+ data.ParsedData.PricedItineraries[i].Directions[1].DepartureAirport +"</div></div>"+ SegmentDuration(i, 1)+"<div class='trip-segment_endpoint'> <img src='img/trip-plane.png' class='trip-segment_plane __arrival' alt=''> <div class='trip-segment_airport __arrival'>"+ data.ParsedData.PricedItineraries[i].Directions[1].ArrivalAirport +"</div></div></div></div><div class='item-trip_schedule'> <div class='item-trip_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].ArrivalDateTime)).format("HH:MM") +"</div><div class='item-trip_city'>"+ data.ParsedData.PricedItineraries[i].Directions[1].ArrivalAirportRu +"</div><div class='item-trip_date'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].ArrivalDateTime)).format("d mmm yyyy, ddd") +"</div></div></div>";
	}
}

$(".section-ticket_right__mobile").append("<div class='section-ticket_item __mobile' item-number='"+i+"'><div class='item-trip-mobile__header'><div class='item-trip_price'>"+ data.ParsedData.PricedItineraries[i].PriceInformation.BaseFare +"₸</div><div class='item-trip_carriers'><img class='trip-carriers_img __mobile' src='img/carrier1.jpg' alt=''><img class='trip-carriers_img __mobile' src='img/carrier1.jpg' alt=''></div><div class='item-trip-label_wrap__mobile'></div></div><div class='item-trip-mobile_outer'><div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>"+ data.ParsedData.PricedItineraries[i].Directions[n].DepartureAirport +" - "+ data.ParsedData.PricedItineraries[i].Directions[n].ArrivalAirport +"</div><div class='item-trip-mobile_text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].DepartureDateTime)).format("HH:MM") +" – "+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].ArrivalDateTime)).format("HH:MM") +"</div></div><div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>В пути</div><div class='item-trip-mobile_text'>" + FlightDuration(n, i)+"</div></div><div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>"+ SegmentCount(i, n) +"</div><div class='item-trip-mobile_text'>"+ SegmentAirport(i, n) +"</div></div>"+ DirectionsMobile(i, n) +"</div></div>");


function DirectionsMobile(i, n){
	if (data.ParsedData.PricedItineraries[i].Directions.length == 1 || n == 1) {
		 return "";
	}else{
		return "<div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>"+ data.ParsedData.PricedItineraries[i].Directions[1].DepartureAirport +" - "+ data.ParsedData.PricedItineraries[i].Directions[1].ArrivalAirport +"</div><div class='item-trip-mobile_text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].DepartureDateTime)).format("HH:MM") +" – "+ new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].ArrivalDateTime)).format("HH:MM") +"</div></div><div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>В пути</div><div class='item-trip-mobile_text'>"+ FlightDuration(1, i)+"</div></div><div class='item-trip-mobile_li'><div class='item-trip-mobile_caption'>"+ SegmentCount(i, 1) +"</div><div class='item-trip-mobile_text'>"+ SegmentAirport(i, 1) +"</div></div>"
	};
};

function SegmentCount(i, n){
	var segment = data.ParsedData.PricedItineraries[i].Directions[n].Segments.length;
	if (segment == 1) {
		return "0 пересадок";
	}else{
		return segment-1 + "пересадка";
	}
}

function SegmentAirport(i, n){
	var segment = data.ParsedData.PricedItineraries[i].Directions[n].Segments.length;
	if (segment == 1) {
		return "---";
	}else{
		return data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].ArrivalAirport;
	}
}

// =====================  preparing for slider
// 	if (data.ParsedData.PricedItineraries[i].Directions[n].Segments.length > 1){
// 		let city = [];
// 		city.push(data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].ArrivalAirportRu);
// //console.log(city[0])

// };

if(data.ParsedData.PricedItineraries[i].Directions[0] != null){
FlyDuration1Row[i] = ((new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[0].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[0].DepartureDateTime)))/60000);

if(FlyDuration1Row[i] > Duration1Max){
     Duration1Max = FlyDuration1Row[i];   
   }

if(FlyDuration1Row[i] < Duration1Min){
     Duration1Min = FlyDuration1Row[i];   
   }
};


FlyDuration2Row[i] = ((new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[1].DepartureDateTime)))/60000);

if(FlyDuration2Row[i] > Duration2Max){
     Duration2Max = FlyDuration2Row[i];   
   }

if(FlyDuration2Row[i] < Duration2Min){
     Duration2Min = FlyDuration2Row[i];   
   }


if (data.ParsedData.PricedItineraries[i].Directions[n].Segments.length > 1){
StopDurationRow[i] = (Math.trunc((new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[1].DepartureDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[i].Directions[n].Segments[0].ArrivalDateTime)))/ 60000 ));

if(StopDurationRow[i] > StopDurationMax){
     StopDurationMax = StopDurationRow[i];   
   }

if(StopDurationRow[i] < StopDurationMin){
     StopDurationMin = StopDurationRow[i];   
   }
};


if(AirlineName.indexOf(data.ParsedData.PricedItineraries[i].ValidatingAirlineName) === -1){
      AirlineName.push(data.ParsedData.PricedItineraries[i].ValidatingAirlineName);
  }

if(data.ParsedData.PricedItineraries[i].Directions[0] != null){
	if(DepartureAirport.indexOf(data.ParsedData.PricedItineraries[i].Directions[0].DepartureAirportRu) === -1){
      DepartureAirport.push(data.ParsedData.PricedItineraries[i].Directions[0].DepartureAirportRu);
  }

  if(ArrivalAirport.indexOf(data.ParsedData.PricedItineraries[i].Directions[0].ArrivalAirportRu) === -1){
      ArrivalAirport.push(data.ParsedData.PricedItineraries[i].Directions[0].ArrivalAirportRu);
  }

  if (data.ParsedData.PricedItineraries[i].Directions[n].Segments.length > 1){
	  if(StopAirport1.indexOf(data.ParsedData.PricedItineraries[i].Directions[0].Segments[0].ArrivalAirport) === -1){
	      StopAirport1.push(data.ParsedData.PricedItineraries[i].Directions[0].Segments[0].ArrivalAirport);
	  }
	}
  
}else{
	if (data.ParsedData.PricedItineraries[i].Directions[n].Segments.length > 1){
	  if(StopAirport2.indexOf(data.ParsedData.PricedItineraries[i].Directions[1].Segments[0].ArrivalAirport) === -1){
	      StopAirport2.push(data.ParsedData.PricedItineraries[i].Directions[1].Segments[0].ArrivalAirport);
	  }
	}
};

PriceRow[i] = data.ParsedData.PricedItineraries[i].PriceInformation.BaseFare;

if(PriceRow[i] > PriceMax){
     PriceMax = PriceRow[i];   
   }

if(PriceRow[i] < PriceMin){
     PriceMin = PriceRow[i];   
   }
// =====================  /preparing for slider

};
// =================== /for(i)

// ====== create-filter
console.log( AirlineName);

for( var b = 0; b < DepartureAirport.length; b++ ){
$(".spoiler-content_DepartureAirport").append("<label class='ticket-spoiler_label'><div class='ticket-check_left'><input type='radio' class='ticket-spoiler__checkbox' name='2' value='2'><span class='ticket-spoiler_fake'></span><p>"+ DepartureAirport[b] + "</p></div><div class='ticket-check_sum'>ALA</div></label>");
}
for( var b = 0; b < ArrivalAirport.length; b++ ){
$(".spoiler-content_ArrivalAirport").append("<label class='ticket-spoiler_label'><div class='ticket-check_left'><input type='radio' class='ticket-spoiler__checkbox' name='3' value='2'><span class='ticket-spoiler_fake'></span><p>"+ ArrivalAirport[b] + "</p></div><div class='ticket-check_sum'>NQZ</div></label>");
}
for( var b = 0; b < StopAirport1.length; b++ ){
$(".spoiler-content_StopAirport1").append("<label class='ticket-spoiler_label'><div class='ticket-check_left'><input type='radio' class='ticket-spoiler__checkbox' name='StopAirport1' value='"+ StopAirport1[b] + "'><span class='ticket-spoiler_fake'></span><p>"+ StopAirport1[b] + "</p></div><div class='ticket-check_sum'></div></label>");
}
for( var b = 0; b < StopAirport2.length; b++ ){
$(".spoiler-content_StopAirport2").append("<label class='ticket-spoiler_label'><div class='ticket-check_left'><input type='radio' class='ticket-spoiler__checkbox' name='StopAirport2' value='"+ StopAirport2[b]+"'><span class='ticket-spoiler_fake'></span><p>"+ StopAirport2[b] + "</p></div><div class='ticket-check_sum'></div></label>");
}
for( var b = 0; b < AirlineName.length; b++ ){
$(".spoiler-content_AirlineName").append("<label class='ticket-spoiler_label'><div class='ticket-check_left'><input type='radio' class='ticket-spoiler__checkbox' name='AirlineName' value='"+ AirlineName[b]+"'><span class='ticket-spoiler_fake'></span><p>"+ AirlineName[b] + "</p></div><div class='ticket-check_sum'></div></label>");
}
// ====== /create-filter
// ====== slider
 $( function() {
    $( "#slider-range1" ).slider({
      range: true,
      min: StopDurationMin,
      step: 5,
      max: StopDurationMax,
      values: [0, StopDurationMax],
      slide: function( event, ui ) {
        $( "#slider_input1" ).val( "от " + TimeEdit(ui.values[ 0 ]) );
        $( "#slider_input2" ).val( "до " + TimeEdit(ui.values[ 1 ]) );
      },
      change: function( event, ui ) {
      	$("#slider_input4").trigger('change');
    }
    });
    $( "#slider_input2" ).val( "до " + TimeEdit(StopDurationMax ));
$( "#slider_input1" ).val( "от " + TimeEdit(StopDurationMin ));
  });


 $( function() {
    $( "#slider-range2" ).slider({
      range: true,
      min: Duration1Min,
      step: 5,
      max: Duration1Max,
      values: [0, Duration1Max],
      slide: function( event, ui ) {
        $( "#slider_input3" ).val( "от " + TimeEdit(ui.values[ 0 ]) );
        $( "#slider_input4" ).val( "до " + TimeEdit(ui.values[ 1 ]) );
      },
      change: function( event, ui ) {
      	$("#slider_input4").trigger('change');
    }
    });
    $( "#slider_input4" ).val( "до " + TimeEdit(Duration1Max ));
$( "#slider_input3" ).val( "от " + TimeEdit(Duration1Min ));
  });


 $( function() {
    $( "#slider-range3" ).slider({
      range: true,
      min: Duration2Min,
      step: 5,
      max: Duration2Max,
      values: [0, Duration2Max],
      slide: function( event, ui ) {
        $( "#slider_input5" ).val( "от " + TimeEdit(ui.values[ 0 ]) );
        $( "#slider_input6" ).val( "до " + TimeEdit(ui.values[ 1 ]) );
      },
      change: function( event, ui ) {
      	$("#slider_input4").trigger('change');
    }
    });
    $( "#slider_input6" ).val( "до " + TimeEdit(Duration2Max ));
$( "#slider_input5" ).val( "от " + TimeEdit(Duration2Min ));
});

 $( function() {
    $( "#slider-range4" ).slider({
      range: true,
      min: PriceMin,
      step: 5,
      max: PriceMax,
      values: [0, PriceMax],
      slide: function( event, ui ) {
        $( "#slider_input7" ).val( "от " + ui.values[ 0 ] + " ₸");
        $( "#slider_input8" ).val( "до " + ui.values[ 1 ] + " ₸");
      },
      change: function( event, ui ) {
      	$("#slider_input4").trigger('change');
    }
    });
    $( "#slider_input8" ).val( "до " + PriceMax + " ₸");
$( "#slider_input7" ).val( "до " + PriceMin + " ₸");
});
// ====== /slider

$(".section-ticket_item[item-number = '0']").find(".item-trip-label_wrap").html("<div class='item-trip_label'>Самый удобный</div>");
$(".section-ticket_item.__mobile[item-number = '0']").find(".item-trip-label_wrap__mobile").append("<div class='item-trip_lable'>Самый дешёвый</div>");

});

$("body").tooltip({
    selector: '[data-toggle="tooltip"]'
});




});

// =========== /btn_sub click ==============

// ===========modal-ticket_airport ==============

$(document).on('click' , '.section-ticket_item-right', TicketModalShow);
$(document).on('click' , '.section-ticket_item.__mobile', TicketModalShow);

function TicketModalShow(){
	ticket.show();
	
	if ($(window).width() > '990'){
	var num = $(this).parents().attr('item-number');
}else{
	var num = $(this).attr('item-number');
}

$.getJSON('mydata.json', function(data) {

	Date.prototype.format = function (mask, utc) {
    return dateFormat(this, mask, utc);
};

if(data.ParsedData.PricedItineraries[num].Directions[0] == null){
	var n=1;
}else{
	var n=0;
}

$(".modal-ticket_right").html(" <div class='modal-ticket_airport'>"+ data.ParsedData.PricedItineraries[num].Directions[n].DepartureAirportRu +" – "+ data.ParsedData.PricedItineraries[num].Directions[n].ArrivalAirportRu +"</div><div class='modal-ticket_time'>"+ FlyDuration(n, num) +" в пути</div><div class='modal-ticket_item'> <div class='modal-ticket_header'> <img class='modal-ticket_airport-img' src='img/airport.jpg' alt=''> <div class='modal-ticket_airport'>"+ data.ParsedData.PricedItineraries[num].ValidatingAirlineName +"</div><div class='modal-ticket_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].FlightDuration)).format("HH ч MM мин")+" в полёте</div></div><div class='modal-ticket_schedule'> <div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].DepartureDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].DepartureDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].DepartureAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].DepartureAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].DepartureAirport +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].ArrivalDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].ArrivalDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].ArrivalAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].ArrivalAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[0].ArrivalAirport +"</div></div></div>" + SegmentModal(num, n) + "</div></div></div>"+DirectionsModal(num));

function CountMinutesStop( num, f ,n ){
return Math.trunc((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[f+1].DepartureDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[f].ArrivalDateTime)))/ 60000 )
}

function FlyDuration(n, num){
 // var day = new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)).format("d") - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)).format("d");
 var day = 0;
 if(day == 0){
 	day = "";
 }else{
 	day = day + " д ";
 }
var hour = Math.trunc((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)))/3600000);
var min = ((new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].ArrivalDateTime)) - new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].DepartureDateTime)))%3600000)/60000;
 return day+hour+" ч "+min+" мин";
}
function StopDuration(i , f, n){
	var min = CountMinutesStop(i, f, n) % 60;
	if (min == 0) {
		min = min + "0";
	}
	return Math.trunc(CountMinutesStop(i, f, n) / 60) + " ч "+ min + " мин";
}

function SegmentModal(num, n){
	var segment = data.ParsedData.PricedItineraries[num].Directions[n].Segments.length;
	if (segment == 1) {
		 return "";
	}else{
		
		return "<div class='modal-ticket_change'> <img class='modal-ticket_change-img' src='img/people.png' alt=''> <div class='modal-ticket_change-text'>Пересадка в "+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureAirportRu+" </div><div class='modal-ticket_change-time'>" +StopDuration(num,0, n)+"</div></div><div class='modal-ticket_header'> <img class='modal-ticket_airport-img' src='img/airport.jpg' alt=''> <div class='modal-ticket_airport'>"+ data.ParsedData.PricedItineraries[num].ValidatingAirlineName +"</div><div class='modal-ticket_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].FlightDuration)).format("HH ч MM мин")+" в полёте</div></div><div class='modal-ticket_schedule'> <div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].DepartureAirport +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].ArrivalDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].ArrivalDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].ArrivalAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].ArrivalAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[n].Segments[1].ArrivalAirport +"</div></div>"
	}
}


function DirectionsModal(num){
	if (data.ParsedData.PricedItineraries[num].Directions.length == 1 || n == 1) {
		 return "";
	}else{
		return " <div class='modal-ticket_airport'>"+ data.ParsedData.PricedItineraries[num].Directions[1].DepartureAirportRu +" – "+ data.ParsedData.PricedItineraries[num].Directions[1].ArrivalAirportRu +"</div><div class='modal-ticket_time'>"+ FlyDuration(1, num) +" в пути</div><div class='modal-ticket_item'> <div class='modal-ticket_header'> <img class='modal-ticket_airport-img' src='img/airport.jpg' alt=''> <div class='modal-ticket_airport'>"+ data.ParsedData.PricedItineraries[num].ValidatingAirlineName +"</div><div class='modal-ticket_time'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[1].Segments[0].FlightDuration)).format("HH ч MM мин")+" в полёте</div></div><div class='modal-ticket_schedule'> <div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[1].DepartureDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[1].Segments[0].DepartureDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[1].DepartureAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[1].DepartureAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[1].DepartureAirport +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[1].ArrivalDateTime)).format("HH:MM") +"</div><div class='modal-ticket_schedule-text'>"+ new Date(Date.parse(data.ParsedData.PricedItineraries[num].Directions[1].Segments[0].ArrivalDateTime)).format("d mmm, ddd") +"</div></div><div class='modal-ticket_schedule-item'> <div class='modal-ticket_schedule-caption'>"+ data.ParsedData.PricedItineraries[num].Directions[1].ArrivalAirportRu +"</div><div class='modal-ticket_schedule-text'>"+ data.ParsedData.PricedItineraries[num].Directions[1].ArrivalAirportRu +", "+ data.ParsedData.PricedItineraries[num].Directions[1].ArrivalAirport +"</div></div></div>" + SegmentModal(num, 1) + "</div></div></div>"
	}
}


$(".modal-ticket_price").html(data.ParsedData.PricedItineraries[num].PriceInformation.BaseFare+ "₸");
$(".modal-btn").html(data.ParsedData.PricedItineraries[num].PriceInformation.BaseFare + " ₸");

});
};

// =========== /modal-ticket_airport ==============


$(".filter-icon").click( function(e){
	$(".section-ticket_left").css("display","none");
	$(".section-ticket_left").addClass("filter").slideToggle(300);
});

$(".ticket-spoiler-mobile_exit").click( function(e){
	$(".section-ticket_left").css("display","block");
	$(".section-ticket_left").removeClass("filter").slideToggle(300);
});

$(".header-form-edit").click( function(e){
	$(".header-form-edit").removeClass("search");
     $(".header-form").removeClass("search");
     $(".filter-icon").removeClass("search");
});




$(".ticket-spoiler_title").click( function(e){
	$(this).toggleClass('active').next().slideToggle(300);
});


$(window).on('load resize', windowSize);

function windowSize(){
    if ($(window).width() > '1200'){
    	$(".filter-icon").removeClass("search");
    	$(".header-form-edit").removeClass("search");
     $(".header-form").removeClass("search");
    if ($(".section-ticket_left").hasClass("search")) {
     $(".section-ticket_left").css("display","block");
   	}	
     
    } else{
    	 if ($(".section-ticket_left").hasClass("search")) {
     		 $(".section-ticket_left").css("display","none");
         $(".filter-icon").addClass("search");
      }	
    	if ($(".header-date_range1").hasClass("active")) {
    		$(".navbar").addClass("datepicker-open");
    	}
    }    
};

var ticket = new bootstrap.Modal($("#modal-ticket"));



$(".modal-ticket_btn").click( function(e){
	ticket.hide();
});


	$(document).mouseup(function (e){ // событие клика по веб-документу
		var div = $(".list-sitter"); // тут указываем ID элемента
		if (!div.is(e.target) // если клик был не по нашему блоку
		    && div.has(e.target).length === 0// и не по его дочерним элементам
		     && !$(".sitter").is(e.target)) { 

    $(".list-sitter").removeClass('active');
    $(".sitter").removeClass('active');
		}

		var div2 = $(".header-date_range1"); // тут указываем ID элемента
		if (!div2.is(e.target) // если клик был не по нашему блоку
		    && div2.has(e.target).length === 0// и не по его дочерним элементам
		     && !$(".box2").is(e.target)) { 
    $(".header-date_range1").removeClass('active');
		}
	});
// ====== Autocomplete Widget
$(function() {
    var projects = [
        {
            value: "ALA",
            label: "Алматы",
            desc: "Казахстан, Домодедово"
        },
        {
            value: "NQZ",
            label: "Нур-Султан",
            desc: ""
        },
        {
            value: "ALA",
            label: "Москва",
            desc: " Казахстан, Шереметьево"
        }
    ];
    
    function lightwell(request, response) {
        function hasMatch(s) {
            return s.toLowerCase().indexOf(request.term.toLowerCase())!==-1;
        }
        var i, l, obj, matches = [];

        if (request.term==="") {
		    response([]);
            return;
        }
           
        for  (i = 0, l = projects.length; i<l; i++) {
            obj = projects[i];
            if (hasMatch(obj.label) || hasMatch(obj.desc) || hasMatch(obj.value)) {
                matches.push(obj);
            }
        }
        response(matches);
    }
    


    $( ".header-form_airport" ).autocomplete({
        minLength: 0,
        source: lightwell,
        focus: function( event, ui ) {
            $(this).val( ui.item.label );
            return false;
        },
        select: function( event, ui ) {
            $(this).val( ui.item.label );
            $(this).next().text( ui.item.value ); // is this needed?
            
            return false;
        }
    }).data( "ui-autocomplete" )._renderItem = function( ul, item ) {
        return $( "<li>" )
            .append( "<a><div><span class='autocomplete_label'>" + item.label + 
                ", </span><span >" + item.desc + "</span></div>" +
                "<span class='autocomplete_value'>"+ item.value+" </span></a>" )
            .appendTo( ul );
    };

    $( ".header-form_airport.input2" ).autocomplete({
        minLength: 0,
        source: lightwell,
        focus: function( event, ui ) {
            $(this).val( ui.item.label );
            return false;
        },
        select: function( event, ui ) {
            $(this).val( ui.item.label );
            $(this).next().text( ui.item.value ); // is this needed?
            
            return false;
        }
    }).data( "ui-autocomplete" )._renderItem = function( ul, item ) {
        return $( "<li>" )
            .append( "<a><div><span class='autocomplete_label'>" + item.label + 
                ", </span><span >" + item.desc + "</span></div>" +
                "<span class='autocomplete_value'>"+ item.value+" </span></a>" )
            .appendTo( ul );
    };
    
});
// ====== /Autocomplete Widget
// ====== datepicker
$.datepicker.regional['ru'] = {
	closeText: 'Закрыть',
	prevText: 'Предыдущий',
	nextText: 'Следующий',
	currentText: 'Сегодня',
	monthNames: ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
	monthNamesShort: ['Янв','Фев','Мар','Апр','Май','Июн','Июл','Авг','Сен','Окт','Ноя','Дек'],
	dayNames: ['воскресенье','понедельник','вторник','среда','четверг','пятница','суббота'],
	dayNamesShort: ['вск','пнд','втр','срд','чтв','птн','сбт'],
	dayNamesMin: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
	weekHeader: 'Не',
	dateFormat: 'dd.mm.yy',
	firstDay: 1,
	isRTL: false,
	showMonthAfterYear: false,
	yearSuffix: ''
};
$.datepicker.setDefaults($.datepicker.regional['ru']);

$(function() {
  $('#date_range').datepicker({
    range: 'period', // режим - выбор периода
    numberOfMonths: 1,
    onSelect: function(dateText, inst, extensionRange) {
    	// extensionRange - объект расширения
      $('[name=startDate]').val(extensionRange.startDateText);
      $('[name=endDate]').val(extensionRange.endDateText);
      $('#startDateMobile').val(extensionRange.startDateText);
			$('#endDateMobile').val(extensionRange.endDateText);
    }
  });

 

  // объект расширения (хранит состояние календаря)
  var extensionRange = $('#date_range').datepicker('widget').data('datepickerExtensionRange');
  if(extensionRange.startDateText) {
  	$('[name=startDate]').val(extensionRange.startDateText);
  }
  if(extensionRange.endDateText) {
  	$('[name=endDate]').val(extensionRange.endDateText);
  }


var debounce;
  // Your window resize function
  $(window).resize(function() {
    // Clear the last timeout we set up.
    clearTimeout(debounce);
    // Your if statement
    if ($(window).width() < 576) {
      // Assign the debounce to a small timeout to "wait" until resize is over
      debounce = setTimeout(function() {
        // Here we're calling with the number of months you want - 1
        debounceDatepicker(3);
      }, 250);
    // Presumably you want it to go BACK to 2 or 3 months if big enough
    // So set up an "else" condition
    } else {
      debounce = setTimeout(function() {
        // Here we're calling with the number of months you want - 3?
        debounceDatepicker(1)
      }, 250);
    }
  // To be sure it's the right size on load, chain a "trigger" to the
  // window resize to cause the above code to run onload
  }).trigger('resize');

  // our function we call to resize the datepicker
  function debounceDatepicker(no) {
    $("#date_range").datepicker("option", "numberOfMonths", no);
  }

});

$("#date_range").append("<div class='datepicker-header'><div class='datepicker-caption'>Дата вылета<img src='img/exit.png'  class='datepicker_close'></div><input readonly type='text' id='startDateMobile' placeholder='Когда' class='datepicker_input'><input readonly type='text' id='endDateMobile' placeholder='Обратно' class='datepicker_input'></div>");

$(".form-datapicker_btn").click( function(e){
	$('[name=endDate]').val("");
	$('#endDateMobile').val("");
	 $('#date_range').datepicker( "option", "endDate", "null" ) ;
	 $('#date_range').datepicker('setDate', $('[name=startDate]').val());
});

$(".box2").click( function(e){
	if ($(window).width() < 576) {
    	$(".navbar").addClass("datepicker-open");
    }
    $(".header-date_range1").toggleClass('active');
    
});


$(".datepicker_close").click( function(e){
	if ($(window).width() < 576) {
    	$(".navbar").toggleClass("datepicker-open");
    }
    $(".header-date_range1").toggleClass('active');
    
});

// ====== /datepicker


//  ============ sorting ============== 
 $( "#filter" ).selectmenu({
 		change: function( event, data ) {
     if ($(window).width() > '990'){
      sortElement()
    }else{
    	sortElement_mobile()
      }
    }
 });

var parent = document.querySelector('.section-ticket_right');
var parent_mobile = document.querySelector('.section-ticket_right__mobile');

function sortElement() {
  [].slice.call(parent.children)
    .sort(function(a, b) {
      // change return value based on order
      return document.querySelector('#filter').value * (getPrice(a) - getPrice(b));
    }).forEach(function(ele) {
      parent.appendChild(ele);
    })
}
function sortElement_mobile() {
  [].slice.call(parent_mobile.children)
    .sort(function(a, b) {
      // change return value based on order
      return document.querySelector('#filter').value * (getPrice_mob(a) - getPrice_mob(b));
    }).forEach(function(ele) {
      parent.appendChild(ele);
    })
}

function getPrice(ele) {
  return Number(ele
      .querySelector('.section-ticket_btn-sum')
      .textContent
      .replace(/[^\d.]+/g, ''))
    // .match(/\d*(?:\.\d+)?/)[0]
    || 0;
}

function getPrice_mob(ele) {
  return Number(ele
      .querySelector('.item-trip_price')
      .textContent
      .replace(/[^\d.]+/g, ''))
    // .match(/\d*(?:\.\d+)?/)[0]
    || 0;
}
// initially sort the element
sortElement();
// bind click event handler

//  ============ /sorting ================

//  ============ filtration ============== 
function TimeEdit(t){
 
 var day = 0;
 if(day == 0){
 	day = "";
 }else{
 	day = day + " д ";
 }
var hour = Math.trunc(t/60);
var min =  t %60;
 return day+hour+" ч "+min+" мин";
}

$("#slider_input4").change(function(){
	Filtration();
})

$('input[type=radio][name=ticket-spoiler]').change(function() {
	Filtration();
});

$(document).on('change' , 'input[type=radio][name=StopAirport2]', Filtration);

function Filtration(){

	var check_ticketSpoiler = $('input[type=radio][name=ticket-spoiler]:checked').val();
	var check_StopAirport2 = $('input[type=radio][name=StopAirport2]:checked').val();
	var slider_input1 =  $( "#slider-range1" ).slider( "values", 0 );
	var slider_input2 = $( "#slider-range1" ).slider( "values", 1 );
	var slider_input3 = $( "#slider-range2" ).slider( "values", 0 );
	var slider_input4 =  $( "#slider-range2" ).slider( "values", 1 );
	var slider_input5 = $( "#slider-range3" ).slider( "values", 0 );
	var slider_input6 = $( "#slider-range3" ).slider( "values", 1 );
	var slider_input7 = $( "#slider-range4" ).slider( "values", 0 );
	var slider_input8 = $( "#slider-range4" ).slider( "values", 1 );

// console.log( TimeEdit($( "#slider-range2" ).slider( "values", 0 )) + " : " + $( "#slider-range2" ).slider( "values" ) )

	$('.section-ticket_item:not(.__mobile)').each( function(element) {

		if ( $(this).attr("segment") == check_ticketSpoiler || check_ticketSpoiler == 1 ) {
			$(this).css('display', 'flex');

			if ( ($(this).attr("stop-duration") >= slider_input1 && $(this).attr("stop-duration") <=  slider_input2) || $(this).attr("stop-duration") == 0) {
				var bool_stop_duration = true;
			} else{
				var bool_stop_duration = false;
			}

			if ( $(this).attr("fly-duration1") >= slider_input3 && $(this).attr("fly-duration1") <=  slider_input4 && $(this).attr("fly-duration2") >= slider_input5 && $(this).attr("fly-duration2")  <=  slider_input6 ) {
				var bool_fly_duration = true;
			} else{
				var bool_fly_duration = false;
				if ($(this).attr("fly-duration2") >= slider_input5 && $(this).attr("fly-duration2")  <=  slider_input6  && $(this).attr("fly-duration1") == 0) {
					var bool_fly_duration = true;
				}
			}
			if ( parseInt($(this).find('.section-ticket_btn-sum').text().replace(/[^\d.]+/g, '')) >= slider_input7 && parseInt($(this).find('.section-ticket_btn-sum').text().replace(/[^\d.]+/g, ''))<= slider_input8 ) {
				var bool_price = true;
			}else{
				var bool_price = false;
			}

			if ( $(this).find('.trip-segment_stop').attr("data-iatas") == check_StopAirport2 || check_StopAirport2 == 1 ){
				var bool_stop_airport = true;
			}else{
				var bool_stop_airport = false;
			}



			if( bool_fly_duration && bool_stop_duration && bool_price && bool_stop_airport){
			$(this).css('display', 'flex')
			}else{
			$(this).css('display', 'none')
			}

		}else{
			$(this).css('display', 'none')
		}
	});
}
//  =========== /filtration ==============   


});

// ====== input-caption
(function() {
				// trim polyfill : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim
				if (!String.prototype.trim) {
					(function() {
						// Make sure we trim BOM and NBSP
						var rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
						String.prototype.trim = function() {
							return this.replace(rtrim, '');
						};
					})();
				}

				[].slice.call( document.querySelectorAll( 'input.input__field' ) ).forEach( function( inputEl ) {
					// in case the input is already filled..
					if( inputEl.value.trim() !== '' ) {
						classie.add( inputEl.parentNode, 'input--filled' );
					}

					// events:
					inputEl.addEventListener( 'focus', onInputFocus );
					inputEl.addEventListener( 'blur', onInputBlur );
				} );

				function onInputFocus( ev ) {
					classie.add( ev.target.parentNode, 'input--filled' );
				}

				function onInputBlur( ev ) {
					if( ev.target.value.trim() === '' ) {
						classie.remove( ev.target.parentNode, 'input--filled' );
					}
				}
			})();
</script>
</body>
</html>
